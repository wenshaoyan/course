<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wenshao.dal.dao.TopicBankDao">
    <insert id="insert" parameterType="_TopicBean" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_topic_bank(tb_create_time,tb_update_time,tb_name,tb_type)
        VALUES(NOW(3),NOW(3),#{name},#{type})
    </insert>
    <insert id="addTopic" parameterType="java.util.Map" >
      INSERT INTO t_topic_relation(tr_topic_id,tr_tb_id) VALUES(#{topic_id},#{tb_id})
    </insert>
    <delete id="removeTopic" parameterType="java.util.Map" >
      DELETE FROM t_topic_relation WHERE tr_topic_id=#{topic_id} AND tr_tb_id=#{tb_id}
    </delete>
    <sql id="select_list">
        select *
        from t_topic_bank
    </sql>
    <sql id="include_topicOption">
        t_topic_option ON t_topic_option.to_topic_id=t_topic.topic_id
    </sql>
    <sql id="include_topic">
        t_topic ON t_topic.topic_tb_id = t_topic_bank.tb_id
    </sql>
    <sql id="select_max">
        SELECT IFNULL(MAX(t_topic.topic_id),0) i
        FROM t_topic_bank
    </sql>
    <sql id="update_table">
        UPDATE t_topic_bank
    </sql>
    <sql id="delete_table">
        DELETE FROM t_topic_bank
    </sql>
    <sql id="update_set">
        <set>
            <if test="title != null" >
                tb_name = #{name},
            </if>
            <if test="type != null">
                tb_type = #{type},
            </if>
        </set>
    </sql>
    <select id="select" parameterType="_AbstractSqlBean"  resultMap="topicBankResult">
        <include refid="select_list"/>
        <if test="abstractSql and abstractSql.includes">
            
        </if>
        <include refid="Base_Condition"/>
        <include refid="Base_Group"/>
        <include refid="Base_Order"/>
        <include refid="Base_Limit"/>
    </select>

    <select id="selectMaxLocation" parameterType="_TopicBankBean" resultType="java.lang.Integer">
        <include refid="select_max"/>
        <include refid="Base_Condition"/>
    </select>

    <update id="update" parameterType="_TopicBankBean" >
        <include refid="update_table" />
        <include refid="update_set" />
        <include refid="Base_Condition" />
    </update>
    <delete id="remove" parameterType="_TopicBankBean">
        <include refid="delete_table"/>
        <include refid="Base_Condition"/>
    </delete>

    <resultMap id="topicBankResult" type="_TopicBankBean">
        <id property="id" column="tb_id"/>
        <result property="create_time_bean" column="tb_create_time"/>
        <result property="update_time_bean" column="tb_update_time"/>
        <result property="name" column="tb_name"/>
        <result property="type" column="tb_type"/>
        <collection property="topics" ofType="_TopicBean" resultMap="mapper.topicMapper.topicResult" />
    </resultMap>
</mapper>